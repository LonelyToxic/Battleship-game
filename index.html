<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>–ú–æ—Ä—Å–∫–æ–π –±–æ–π</title>
    <style>
        /* –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø–æ–ª—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        .fields-container {
            display: none;
            justify-content: flex-start;
            margin-top: 20px;
            gap: 50px;
        }

        table {
            border-collapse: collapse;
        }

        td {
            width: 30px;
            height: 30px;
            border: 1px solid black;
            text-align: center;
            vertical-align: middle;
            font-size: 20px;
        }

        .occupied {
            background-color: lightblue;
        }

        .player-field {
            margin-left: 0px;
        }
    </style>
</head>
<body>
    <h1>–ú–æ—Ä—Å–∫–æ–π –±–æ–π</h1>

    <div class="gameButtons">
        <button id="start-game-button">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        <button id="reset-game-button">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É</button>
        <button id="radnom-ship-place-button">–°–ª—É—á–∞–π–Ω–æ —Ä–∞—Å–ø–æ–ª–æ–∂–∏—Ç—å –∫–æ—Ä–∞–±–ª–∏</button>
    </div>

    <div class="shipPlacerControls">
        <button class="selectShip" data-size="4">–õ–∏–Ω–∫–æ—Ä (4 –∫–ª–µ—Ç–∫–∏)</button>
        <button class="selectShip" data-size="3">–ö—Ä–µ–π—Å–µ—Ä (3 –∫–ª–µ—Ç–∫–∏)</button>
        <button class="selectShip" data-size="2">–≠—Å–º–∏–Ω–µ—Ü (2 –∫–ª–µ—Ç–∫–∏)</button>
        <button class="selectShip" data-size="1">–¢–æ—Ä–ø–µ–¥–Ω—ã–π –∫–∞—Ç–µ—Ä (1 –∫–ª–µ—Ç–∫–∞)</button>

        <button id="direction">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ</button>
    </div>

    <div class="fields-container">
        <table id="player-field" class="player-field">
        </table>
        <table id="computer-field" class="computer-field">
        </table>
    </div>
    <script>
        let selectedShip = null; // –í—ã–±—Ä–∞–Ω–Ω—ã–π –∫–æ—Ä–∞–±–ª—å –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
        let direction = 'horizontal'; // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        function createTable(tableId, tableClass) {
            const table = document.createElement('table');
            table.id = tableId;
            table.classList.add(tableClass);

            for (let i = 0; i < 10; i++) {
                const tr = document.createElement('tr');
                for (let j = 0; j < 10; j++) {
                    const td = document.createElement('td');
                    td.id = `${tableId}-cell-${i}-${j}`;
                    td.classList.add('cell');

                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }

            return table;
        }

        const container = document.querySelector('.fields-container');
        const playerTable = createTable('player-field', 'player-field');
        const computerTable = createTable('computer-field', 'computer-field');
        container.appendChild(playerTable);
        container.appendChild(computerTable);

        // –ú–∞—Å—Å–∏–≤ —Ç–∏–ø–æ–≤ –∫–æ—Ä–∞–±–ª–µ–π
        const shipTypes = [
            {name: '–õ–∏–Ω–∫–æ—Ä', size: 4},
            {name: '–ö—Ä–µ–π—Å–µ—Ä', size: 3},
            {name: '–ö—Ä–µ–π—Å–µ—Ä', size: 3},
            {name: '–≠—Å–º–∏–Ω–µ—Ü', size: 2},
            {name: '–≠—Å–º–∏–Ω–µ—Ü', size: 2},
            {name: '–≠—Å–º–∏–Ω–µ—Ü', size: 2},
            {name: '–¢–æ—Ä–ø–µ–¥–Ω—ã–π –∫–∞—Ç–µ—Ä', size: 1},
            {name: '–¢–æ—Ä–ø–µ–¥–Ω—ã–π –∫–∞—Ç–µ—Ä', size: 1},
            {name: '–¢–æ—Ä–ø–µ–¥–Ω—ã–π –∫–∞—Ç–µ—Ä', size: 1},
            {name: '–¢–æ—Ä–ø–µ–¥–Ω—ã–π –∫–∞—Ç–µ—Ä', size: 1}
        ];

        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–∞ "availableShips"
        let availableShips = {
            4: 1, // –õ–∏–Ω–∫–æ—Ä
            3: 2, // –ö—Ä–µ–π—Å–µ—Ä—ã
            2: 3, // –≠—Å–º–∏–Ω—Ü—ã
            1: 4  // –ö–∞—Ç–µ—Ä–∞
        };

        const playerShips = []; // –ú–∞—Å—Å–∏–≤ –∫–æ—Ä–∞–±–ª–µ–π –∏–≥—Ä–æ–∫–∞
        const computerShips = []; // –ú–∞—Å—Å–∏–≤ –∫–æ—Ä–∞–±–ª–µ–π –∫–æ–º–ø—å—é—Ç–µ—Ä–∞

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è
        function canPlaceShip(table, startX, startY, size, direction) {
            for(let i = 0; i < size; i++) {
                const x = direction === 'horizontal' ? startX : startX + i;
                const y = direction === 'horizontal' ? startY + i : startY;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Ö–æ–¥–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –∏ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ –∫–ª–µ—Ç–∫–∏
                if (x >= 10 || y >= 10 || document.getElementById(`${table.id}-cell-${x}-${y}`).classList.contains('occupied')) {
                    return false;
                }
            }
            return true;
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –µ–≥–æ –≤ –º–∞—Å—Å–∏–≤ –∫–æ—Ä–∞–±–ª–µ–π
        function placeShip(table, startX, startY, size, direction, shipsArray) {
            const shipCells = [];

            for (let i = 0; i < size; i++) {
                const x = direction === 'horizontal' ? startX : startX + i;
                const y = direction === 'horizontal' ? startY + i : startY;

                const cell = document.getElementById(`${table.id}-cell-${x}-${y}`);
                cell.classList.add('occupied');

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–æ—Ä–∞–±–ª—å —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ–ª–µ –∏–≥—Ä–æ–∫–∞
                if(table.id === 'player-field') {
                    cell.textContent = 'üö¢'; 
                }

                shipCells.push({x: x, y: y, hit: false});
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–∞–±–ª—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–∞—Å—Å–∏–≤
            shipsArray.push({
                size: size,
                cells: shipCells,
                sunk: false
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª–µ–π
        function placeShipAutomatically(table, shipTypes) {
            shipTypes.forEach(ship => {
                let placed = false;
                let attempts = 0;
                let maxAttempts = 1000;
                while(!placed && attempts < maxAttempts) {
                    const startX = Math.floor(Math.random() * 10);
                    const startY = Math.floor(Math.random() * 10);

                    const direction = Math.random() < 0.5 ? 'horizontal' : 'vertical';

                    if (canPlaceShip(table, startX, startY, ship.size, direction)) {
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≤ –∫–∞–∫–æ–π –º–∞—Å—Å–∏–≤ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–æ—Ä–∞–±–ª—å
                        const shipsArray = table.id === 'player-field' ? playerShips : computerShips;
                        placeShip(table, startX, startY, ship.size, direction, shipsArray); // –ü–µ—Ä–µ–¥–∞—ë–º shipsArray

                        placed = true;
                    }
                    attempts++;
                }
                if (attempts >= maxAttempts) {
                    console.error(`–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ä–∞–±–ª—å ${ship.name} –ø–æ—Å–ª–µ ${maxAttempts} –ø–æ–ø—ã—Ç–æ–∫`);
                }
            });
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–º–µ—â–∞–µ–º –∫–æ—Ä–∞–±–ª–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        placeShipAutomatically(computerTable, shipTypes);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –∫–æ—Ä–∞–±–ª—è –∏–≥—Ä–æ–∫–æ–º
        document.querySelectorAll('.selectShip').forEach(button => {
            button.addEventListener('click', function() {
                const size = parseInt(this.getAttribute('data-size'));
                if(availableShips[size] > 0) {
                    selectedShip = {size: size};  
                    availableShips[size]--; // –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ—Ä–∞–±–ª–µ–π
                } else {
                    alert('–ö–æ—Ä–∞–±–ª–∏ –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å');
                }
            })
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è
        document.getElementById('direction').addEventListener('click', function() {
            direction = (direction === 'horizontal') ? 'vertical' : 'horizontal';
            this.textContent = (direction === 'horizontal') ? '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ' : '–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ';
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è –Ω–∞ –ø–æ–ª–µ –∏–≥—Ä–æ–∫–∞
        document.querySelectorAll('#player-field .cell').forEach(cell => {
            cell.addEventListener('click', function() {
                if (!selectedShip) {
                    alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–∞–±–ª—å!');
                    return;
                }

                const cellId = this.id;
                const parts = cellId.split('-');
                const x = parseInt(parts[3]);
                const y = parseInt(parts[4]);

                if(canPlaceShip(playerTable, x, y, selectedShip.size, direction)) {
                    placeShip(playerTable, x, y, selectedShip.size, direction, playerShips); // –ü–µ—Ä–µ–¥–∞—ë–º playerShips
                    selectedShip = null;
                } else {
                    alert('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ä–∞–±–ª—å —Å—é–¥–∞!')
                }
            })
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–±—Ä–æ—Å–∞ –∏–≥—Ä—ã
        document.getElementById('reset-game-button').addEventListener('click', function() {
            // –°–±—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ—Ä–∞–±–ª–∏
            availableShips = {
                4: 1, // –õ–∏–Ω–∫–æ—Ä
                3: 2, // –ö—Ä–µ–π—Å–µ—Ä—ã
                2: 3, // –≠—Å–º–∏–Ω—Ü—ã
                1: 4  // –ö–∞—Ç–µ—Ä–∞
            };

            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è –∏–≥—Ä–æ–∫–∞
            document.querySelectorAll('#player-field .cell').forEach(cell => {
                cell.classList.remove('occupied');
                cell.textContent = '';
            });

            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
            document.querySelectorAll('#computer-field .cell').forEach(cell => {
                cell.classList.remove('occupied');
                cell.textContent = '';
            });

            // –û—á–∏—Å—Ç–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤ –∫–æ—Ä–∞–±–ª–µ–π
            playerShips.length = 0;
            computerShips.length = 0;

            // –í–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –∫–æ—Ä–∞–±–ª–µ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
            document.querySelectorAll('.selectShip').forEach(button => {
                const size = parseInt(button.getAttribute('data-size'));
                button.disabled = false;
                button.textContent = `${button.textContent.split('(')[0].trim()} (${availableShips[size]})`;
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
        document.getElementById('start-game-button').addEventListener('click', function() {
            document.querySelector('.fields-container').style.display = 'flex'; 

            this.disabled = true;
        });
    </script>
</body>
</html>
