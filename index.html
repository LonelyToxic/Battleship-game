<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <title>–ú–æ—Ä—Å–∫–æ–π –±–æ–π</title>
        <style>

            .fields-container {
                display: flex;
                justify-content: flex-start;
                margin-top: 20px;
                gap: 50px;
            }

            table {
                border-collapse: collapse;
            }

            td {
                width: 30px;
                height: 30px;
                border: 1px solid black;
                text-align: center;
                vertical-align: middle;
                font-size: 20px;
            }

            .occupied {
                background-color: lightblue;
            }

            .player-field {
                margin-left: 0px;
            }
            
        </style>
    </head>
    <body>
        <h1>–ú–æ—Ä—Å–∫–æ–π –±–æ–π</h1>

        <div class="gameButtons">
            <button id="start-game">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            <button id="reset-game">–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É</button>
            <button id="radnomShipPlacement">–°–ª—É—á–∞–π–Ω–æ —Ä–∞—Å–ø–æ–ª–æ–∂–∏—Ç—å –∫–æ—Ä–∞–±–ª–∏</button>
        </div>

        <div class="shipPlacerControls">
            <button class="selectShip" data-size="4">–õ–∏–Ω–∫–æ—Ä (4 –∫–ª–µ—Ç–∫–∏)</button>
            <button class="selectShip" data-size="3">–ö—Ä–µ–π—Å–µ—Ä (3 –∫–ª–µ—Ç–∫–∏)</button>
            <button class="selectShip" data-size="2">–≠—Å–º–∏–Ω–µ—Ü (2 –∫–ª–µ—Ç–∫–∏)</button>
            <button class="selectShip" data-size="1">–¢–æ—Ä–ø–µ–¥–Ω—ã–π –∫–∞—Ç–µ—Ä (1 –∫–ª–µ—Ç–∫–∞)</button>

            <button id="direction">–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ</button>
        </div>

        <div class="fields-container">
            <table id="player-field" class="player-field">
            </table>
            <table id="computer-field" class="computer-field">
            </table>
        </div>
        <script>
            let selectedShip = null;
            let direction = 'horizontal';

            function createTable(tableId, tableClass) {
                const table = document.createElement('table');
                table.id = tableId;
                table.classList.add(tableClass);

             for (let i = 0; i < 10; i++) {
                const tr = document.createElement('tr');
                for (let j = 0; j < 10; j++) {
                    const td = document.createElement('td');
                    td.id = `${tableId}-cell-${i}-${j}`;
                    td.classList.add('cell');

                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }

            return table;
        }

            const container = document.querySelector('.fields-container');
            const playerTable = createTable('player-field', 'player-field');
            const computerTable = createTable('computer-field', 'computer-field')
            container.appendChild(playerTable);
            container.appendChild(computerTable);

            const shipTypes = [
                {name: '–õ–∏–Ω–∫–æ—Ä', size: 4},
                {name: '–ö—Ä–µ–π—Å–µ—Ä', size: 3},
                {name: '–ö—Ä–µ–π—Å–µ—Ä', size: 3},
                {name: '–≠—Å–º–∏–Ω–µ—Ü', size: 2},
                {name: '–≠—Å–º–∏–Ω–µ—Ü', size: 2},
                {name: '–≠—Å–º–∏–Ω–µ—Ü', size: 2},
                {name: '–¢–æ—Ä–ø–µ–¥–Ω—ã–π –∫–∞—Ç–µ—Ä', size: 1},
                {name: '–¢–æ—Ä–ø–µ–¥–Ω—ã–π –∫–∞—Ç–µ—Ä', size: 1},
                {name: '–¢–æ—Ä–ø–µ–¥–Ω—ã–π –∫–∞—Ç–µ—Ä', size: 1},
                {name: '–¢–æ—Ä–ø–µ–¥–Ω—ã–π –∫–∞—Ç–µ—Ä', size: 1}
            ];

            function canPlaceShip(table, startX, startY, size, direction) {
                for(let i = 0; i < size; i++) {
                    const x = direction === 'horizontal' ? startX : startX + i;
                    const y = direction === 'horizontal' ? startY + i : startY;

                    if (x >= 10 || y >= 10 || document.getElementById(`${table.id}-cell-${x}-${y}`).classList.contains('occupied')) {
                        return false;
                    }
                }
                return true;
            }

            function placeShip(table, startX, startY, size, direction) {
                for (let i = 0; i < size; i++) {
                    const x = direction === 'horizontal' ? startX : startX + i;
                    const y = direction === 'horizontal' ? startY + i : startY;

                    const cell = document.getElementById(`${table.id}-cell-${x}-${y}`);
                    cell.classList.add('occupied');
                    cell.textContent = 'üö¢';
                }
            }

            function placeShipAutomatically(table, shipTypes) {
                shipTypes.forEach(ship => {
                    let placed = false;
                    let attempts = 0;
                    let maxAttempts = 1000;
                    while(!placed && attempts < maxAttempts) {
                        const startX = Math.floor(Math.random() * 10);
                        const startY = Math.floor(Math.random() * 10);

                        const direction = Math.random() < 0.5 ? 'horizontal' : 'vertical';

                        if (canPlaceShip(table, startX, startY, ship.size, direction)) {
                            placeShip(table, startX, startY, ship.size, direction);

                            placed = true;
                        }
                        attempts++;
                    }
                    if (attempts >= maxAttempts) {
                        console.error(`–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ä–∞–±–ª—å ${ship.name} –ø–æ—Å–ª–µ ${maxAttempts} –ø–æ–ø—ã—Ç–æ–∫`);
                    }
                })
            }

            placeShipAutomatically(computerTable, shipTypes);

            document.querySelectorAll('.selectShip').forEach(button => {
                button.addEventListener('click', function() {
                    const size = parseInt(this.getAttribute('data-size'));
                    selectedShip = {size: size};
                })
            })

            document.getElementById('direction').addEventListener('click', function() {
                direction = (direction === 'horizontal') ? 'vertical' : 'horizontal';
                this.textContent = (direction === 'horizontal') ? '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ' : '–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ';
                }
            )

            document.querySelectorAll('#player-field .cell').forEach(cell => {
                cell.addEventListener('click', function() {
                    if (!selectedShip) {
                        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–∞–±–ª—å!');
                        return;
                    }

                    const cellId = this.id;
                    const parts = cellId.split('-');
                    const x = parseInt(parts[3]);
                    const y = parseInt(parts[4]);

                    if(canPlaceShip(playerTable, x, y, selectedShip.size, direction)) {
                        placeShip(playerTable, x, y, selectedShip.size, direction);
                        selectedShip = null;
                    } else {
                        alert('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ä–∞–±–ª—å —Å—é–¥–∞!')
                    }
                })
            })
        </script>
    </body>
</html>